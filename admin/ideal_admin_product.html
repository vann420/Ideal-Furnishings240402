<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDEAL Furnishings 管理系統</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/all.min.css">
    <link rel="stylesheet" href="../css/myall.css">
    <link rel="stylesheet" href="../css/spa.css">
    <link href="../img/favicon.ico" rel="shortcut icon" />
    <link rel="stylesheet" href="../css/scrollToTopBtn.css">
    <style>
        .banner {
            height: 280px;
            background-image: url(../img/sofa10.jpg);
            background-position: center 60%;
            background-size: cover;
        }

        #prevImg {
            height: 180px;
        }

        #update_modal_pimage {
            height: 180px;
        }

        #prevImg_update {
            height: 180px;
        }
    </style>

</head>

<body>
    <!-- 回到上方按鈕 -->
    <button id="scrollToTopBtn" onclick="scrollToTop()"><i class="fa-solid fa-chevron-up"></i>
        <div>TOP</div>
    </button>
    <button id="scrollToBottomBtn" onclick="scrollToBottom()"><i class="fa-solid fa-chevron-down"></i>
        <div>BOTTOM</div>
    </button>


    <!-- section01 navbar-->
    <div class="fixed-top">

        <!-- section02 navbar-->

        <section>
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark ">
                <div class="container">
                    <div class="wow animate__backInDown " data-wow-duration="1s" data-wow-delay="0s"
                        data-wow-iteration="1">
                        <a class="navbar-brand" href="#">
                            <i class="fa-solid fa-couch"></i>
                        </a>
                    </div>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active pe-3 fw-800 " aria-current="page"
                                    href="admin/ideal_admin_index.html"> IDEAL Furnishings 管理系統</a>
                            </li>
                            <li class="nav-item px-4 d-none" id="nav_01">
                                <a class="nav-link " aria-current="page"
                                    href="admin/ideal_admin_product_create.html">商品建檔</a>
                            </li>
                            <li class="nav-item px-4 d-none" id="nav_02">
                                <a class="nav-link active" aria-current="page"
                                    href="admin/ideal_admin_product.html">商品管理</a>
                            </li>
                            <li class="nav-item px-4 d-none" id="nav_03">
                                <a class="nav-link " aria-current="page" href="admin/ideal_admin_order.html">訂單管理</a>
                            </li>
                            <li class="nav-item px-4 d-none" id="nav_04">
                                <a class="nav-link " aria-current="page"
                                    href="admin/ideal_admin_member_control.html">會員管理</a>
                            </li>

                        </ul>

                        <div>


                            <li class="nav-item dropdown list-unstyled text-light d-none" id="member_list">
                                <a class="nav-link dropdown-toggle ps-3" href="#" role="button"
                                    data-bs-toggle="dropdown" aria-expanded="false" id="user_message">
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <li><a class="dropdown-item " href="#" target="_blank">管理員資訊</a></li>
                                    <li><a class="dropdown-item " href="#" id="logout_btn">管理員登出</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item disabled" href="#">Something else here</a></li>
                                </ul>
                            </li>

                            <button class="btn btn-outline-warning me-2 " data-bs-toggle="modal"
                                data-bs-target="#loginModal" id="nav_log_btn">登入</button>
                            <button class="btn btn-warning me-2 " data-bs-toggle="modal" data-bs-target="#registerModal"
                                id="nav_reg_btn">註冊</button>


                        </div>
                    </div>
                </div>
            </nav>

        </section>
    </div>

    <!-- section02 loginModal -->
    <div class="modal fade" id="loginModalAdmin" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header text-bg-dark">
                    <h5 class="modal-title" id="exampleModalLabel">管理員登入</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <label for="login_username" class="form-label">帳號</label>
                    <input type="text" class="form-control" id="loginAdmin_username" name="loginAdmin_username">
                    <label for="login_password" class="form-label">密碼</label>
                    <input type="password" class="form-control" id="loginAdmin_password" name="loginAdmin_password">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-warning" id="loginAdmin_btn">登入</button>
                </div>
            </div>
        </div>
    </div>



    <!-- 登入註冊 -->
    <!-- section02 loginModal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header text-bg-dark">
                    <h5 class="modal-title" id="exampleModalLabel">管理員登入</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <label for="login_username" class="form-label">帳號</label>
                    <input type="text" class="form-control" id="login_username" name="login_username">
                    <label for="login_password" class="form-label">密碼</label>
                    <input type="password" class="form-control" id="login_password" name="login_password">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-warning" id="login_btn">登入</button>
                </div>
            </div>
        </div>
    </div>

    <!-- section02 registerModal -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header text-bg-dark">
                    <h5 class="modal-title" id="exampleModalLabel">管理員註冊</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row">

                        <div class="col-12">
                            <div>
                                <!-- for取username，點標籤時會帶到輸入框 -->
                                <label for="username" class="form-label">帳號</label>
                                <input type="text" class="form-control " placeholder="請輸入6至12字半形英文或數字" id="username"
                                    name="username">
                                <div class="valid-feedback">帳號可以使用</div>
                                <div class="invalid-feedback">帳號不可以使用</div>
                            </div>

                            <div>
                                <label for="email" class="form-label">電子郵件</label>
                                <input type="text" class="form-control" placeholder="請輸入電子郵件信箱" id="email" name="email">
                                <div class="valid-feedback">格式符合規定</div>
                                <div class="invalid-feedback">格式不符合規定</div>
                            </div>

                            <div>
                                <label for="password" class="form-label">密碼</label>
                                <input type="password" class="form-control" placeholder="請輸入6至12字半形英文或數字" id="password"
                                    name="password">
                                <div class="valid-feedback">字數符合規定</div>
                                <div class="invalid-feedback">字數不符合規定</div>
                            </div>

                            <div>
                                <label for="" class="form-label">確認密碼</label>
                                <input type="password" class="form-control" placeholder="請確認密碼" id="re_password"
                                    name="re_password">
                                <div class="valid-feedback">輸入內容相符</div>
                                <div class="invalid-feedback">輸入內容不相符</div>
                            </div>

                            <div class="form-check pt-3">
                                <input class="form-check-input" type="checkbox" id="chk01" name="chk01">
                                <label class="form-check-label" for="chk01">
                                    確認註冊
                                </label>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-warning" id="reg_btn">註冊</button>
                </div>
            </div>
        </div>
    </div>

    <!-- section03 banner -->
    <div class="banner bg-cover"></div>

    <!-- section04 -->
    <div class="container py-4">
        <div class="row">
            <div class="col-md-2">
                <ul class="list-group " id="mylist">
                </ul>
            </div>
            <div class="col-md-10">
                <h5 class=" mb-2">管理系統 / 商品管理</h5>
                <table class="table table-striped table-hover my-4">
                    <thead class="table-dark">
                        <tr>
                            <th class="text-center">編號</th>
                            <th class="text-center">名稱</th>
                            <th class="text-center">圖片</th>
                            <th class="text-center ">分類</th>
                            <th class="text-center ">介紹</th>
                            <th class="text-center">數量</th>
                            <th class="text-center">價格</th>
                            <th class="text-center">上架</th>
                            <th class="text-center">變更</th>


                        </tr>
                    </thead>
                    <tbody id="mydata">
                        <tr>
                            <td>北歐風格休閒椅</td>
                            <td class="text-center"><img src="https://fakeimg.pl/150x80/200"></td>
                            <td> <span class="badge text-bg-danger">沙發系列</span></td>
                            <td>北歐風格休閒椅設計簡約清新，以優質布料製成，給人舒適愜意的感覺，適合休閒放鬆的角落。</td>
                            <td>10</td>
                            <td>10</td>
                            <td>已上架</td>
                            <td class="text-center d-flex flex-column"><button class="btn btn-success m-1"
                                    data-bs-toggle="modal" data-bs-target="#update_btn" id="update_btn"
                                    name="update_modal">修改</button><button class="btn btn-danger m-1" id="delete_btn"
                                    name="delete_btn">刪除</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>


        <!-- update Modal -->
        <div class="modal fade" id="update_modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-dark">
                        <h1 class="modal-title fs-5 text-bg-dark" id="exampleModalLabel">商品修改</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="update_modal_pname" class="form-check-label fw-800">名稱</label>
                            <input type="text" class="form-control" id="update_modal_pname" name="update_modal_pname">
                        </div>

                        <div class="mb-3"><label for="update_modal_pimage" class="form-label fw-800">圖片上傳</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <input type="file" class="form-control" id="fileupload" name="fileupload">
                                </div>
                                <div class="col-md-6">

                                    <img src="" alt="" class="  rounded-2" id="prevImg_update">
                                </div>
                            </div>


                        </div>

                        <div class="mb-3">
                            <label for="update_modal_ptype" class="form-label fw-800">商品分類</label>
                            <select name="update_modal_ptype" id="update_modal_ptype" class="form-select">
                                <option selected disabled>---選擇分類---</option>
                                <option value="沙發系列">沙發系列</option>
                                <option value="茶几桌子">茶几桌子</option>
                                <option value="收納系列">收納系列</option>
                                <option value="寢室家具">寢室家具</option>
                            </select>

                        </div>
                        <div class="mb-3">
                            <label for="update_modal_pintro" class="form-check-label fw-800">介紹
                            </label>
                            <textarea type="text" class="form-control" id="update_modal_pintro"
                                name="update_modal_pintro"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="update_modal_psize" class="form-check-label fw-800">尺寸
                            </label>
                            <input type="text" class="form-control" id="update_modal_psize" name="update_modal_psize">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="update_modal_num" class="form-check-label fw-800">數量
                                </label>
                                <input type="number" class="form-control" id="update_modal_num" name="update_modal_num">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="update_modal_price" class="form-check-label fw-800">價格
                                </label>
                                <input type="number" class="form-control" id="update_modal_price"
                                    name="update_modal_price">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="update_modal_shelf" class="form-label fw-800">上架</label>
                            <div class="form-check form-switch">
                                <input type="checkbox" id="update_modal_shelf" class="form-check-input">
                                <label for="update_modal_shelf" class="form-check-label">上架</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-warning" id="modal_update_btn">保存修改</button>
                    </div>
                </div>

            </div>
        </div>

        <!-- 頁數 -->
        <div class="container my-3">
            <nav aria-label="...">
                <ul class="pagination justify-content-center" id="pageList">
                    <li class="page-item disabled">
                        <span class="page-link">Previous</span>
                    </li>
                    <li class="page-item"><a class="page-link" href="#" onclick="drawTable(0)" id="page">1</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- footer -->
    <section>
        <ul class="nav justify-content-center bg-dark mb-auto">

            <li class="nav-item">
                <a class="nav-link disabled " href="#" tabindex="-1" aria-disabled="true"> IDEAL Furnishings @
                    2024</a>
            </li>
        </ul>
    </section>


    <section>
        <script src="../js/bootstrap.bundle.min.js"></script>
    <script src="../js/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.4/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/counterup2@2.0.2/dist/index.js">	</script>
    <script src="../js/cookie.js"></script>
    <script src="../js/admin_login.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



        <script>
            var u_id; //for update
            var newData = [];
            var dataJSON = {};
            var flag_upload;
            var switch01 = "未上架"; //記錄上架狀態
            var filteredData = [];
            var oldImage; //紀錄舊圖檔名稱
            $(function () {

                // 監聽_圖片 #image
                $("#fileupload").change(function () {
                    console.log(fileupload);
                    console.log(fileupload.files[0]);
                    console.log(fileupload.files[0].name);
                    console.log(fileupload.files[0].size);
                    console.log(fileupload.files[0].type);
                    // fileupload.files
                    // 圖片於瀏覽器的暫存路徑
                    console.log(URL.createObjectURL(fileupload.files[0]));

                    if (
                        fileupload.files[0].type == "image/jpeg" ||
                        fileupload.files[0].type == "image/png"
                    ) {
                        // 顯示預覽圖
                        $("#prevImg_update").removeClass("d-none");
                        // attr換參數
                        $("#prevImg_update").attr("src", URL.createObjectURL(fileupload.files[0]));
                        flag_upload = true;
                    } else {
                        alert("圖片格式不符合");
                        flag_upload = false;
                    }
                });



                // 監聽switch上架
                $("#update_modal_shelf").click(function () {
                    // this現在的動作
                    console.log($(this).is(':checked'));
                    if ($(this).is(':checked')) {
                        $(this).next().text('已上架');
                        switch01 = 'Y';
                    } else {
                        $(this).next().text('未上架');
                        switch01 = '未上架';
                    }
                });


                // Read member data
                $.ajax({
                    type: "GET",
                    url: "http://192.168.10.59/202312/admin_product_read_api.php",
                    // async: false,
                    dataType: "json",
                    success: function (data) {
                        showDataList(data);
                        showdata(data);
                    },
                    error: function () {
                        alert("error-admin_product_read_api.php");
                    }
                });




                // #update_btn modify button
                $("body").on("click", "#mydata #update_btn", function () {

                    u_id = $(this).data("id");
                    $("#update_modal_pname").val($(this).data("pname"));
                    $("#prevImg_update").attr("src", 'http://192.168.10.59/202312/upload/' + $(this).data("pimage"))
                    $("#update_modal_ptype").val($(this).data("ptype"));
                    $("#update_modal_pintro").val($(this).data("pintro"));
                    $("#update_modal_psize").val($(this).data("psize"));
                    $("#update_modal_num").val($(this).data("num"));
                    $("#update_modal_price").val($(this).data("price"));
                    $("input[id=update_modal_shelf]").prop("checked", $(this).data("shelf"));

                    oldImage = $(this).data("pimage");
                    console.log($("input[id=update_modal_shelf]").prop("checked", true));
                });

                // #delete_modal_btn listen to delete button
                $("body").on("click", "#mydata #delete_btn", function () {
                    if (confirm("確認刪除？")) {
                        console.log($(this).data("id"));
                        var dataJSON = {};
                        dataJSON["ID"] = $(this).data("id");
                        console.log(JSON.stringify(dataJSON));

                        $.ajax({
                            type: "POST",
                            url: "admin_product_delete_api.php",
                            data: JSON.stringify(dataJSON),
                            dataType: "json",
                            success: showdata_delete,
                            error: function () {
                                alert("error-admin_product_delete_api.php");
                            }
                        });
                    }
                });

                // #update_modal_btn listen to modify button(confirm)
                $("#modal_update_btn").click(function () {
                    if (flag_upload) {
                        var formdata = new FormData();
                        formdata.append("file", fileupload.files[0]);
                        console.log(formdata); // 傳遞formdata至後端api 
                        $.ajax({
                            type: "POST",
                            url: "/202312/admin_product_create_image_api.php",
                            data: formdata,
                            dataType: "json",
                            cache: false,
                            contentType: false,
                            processData: false,
                            success: showdata_image,
                            error: function () {
                                alert("/202312/admin_product_create_image_api.php");
                            },
                        });
                    } else if (!flag_upload) {
                        var formdata = new FormData();
                        formdata.append("file", fileupload.files[0]);
                        console.log(formdata); // 傳遞formdata至後端api 
                        $.ajax({
                            type: "POST",
                            url: "/202312/admin_product_create_image_api.php",
                            data: formdata,
                            dataType: "json",
                            cache: false,
                            contentType: false,
                            processData: false,
                            success: showdata_oldimage,
                            error: function () {
                                alert("/202312/admin_product_create_image_api.php");
                            },
                        });
                    }

                });


            });

            function showdata_image(data) {

                var dataJSON = {};
                dataJSON["ID"] = u_id;
                dataJSON["Pname"] = $("#update_modal_pname").val();
                dataJSON["Pimage"] = data.datainfo["name"];
                dataJSON["Ptype"] = $("#update_modal_ptype").val();
                dataJSON["Pintro"] = $("#update_modal_pintro").val();
                dataJSON["Psize"] = $("#update_modal_psize").val();
                dataJSON["Num"] = $("#update_modal_num").val();
                dataJSON["Price"] = $("#update_modal_price").val();
                dataJSON["Shelf"] = $("#update_modal_shelf").prop("checked") ? "Y" : "未上架";
                console.log(JSON.stringify(dataJSON));

                $.ajax({
                    type: "POST",
                    url: "admin_product_update_api.php",
                    data: JSON.stringify(dataJSON),
                    dataType: "json",
                    success: showdata_update,
                    error: function () {
                        alert("error-admin_product_update_api.php");
                    }
                });
            }

            function showdata_oldimage(data) {
                var dataJSON = {};
                dataJSON["ID"] = u_id;
                dataJSON["Pname"] = $("#update_modal_pname").val();
                dataJSON["Pimage"] = oldImage;
                dataJSON["Ptype"] = $("#update_modal_ptype").val();
                dataJSON["Pintro"] = $("#update_modal_pintro").val();
                dataJSON["Psize"] = $("#update_modal_psize").val();
                dataJSON["Num"] = $("#update_modal_num").val();
                dataJSON["Price"] = $("#update_modal_price").val();
                dataJSON["Shelf"] = $("#update_modal_shelf").prop("checked") ? "Y" : "未上架";
                console.log(JSON.stringify(dataJSON));

                $.ajax({
                    type: "POST",
                    url: "admin_product_update_api.php",
                    data: JSON.stringify(dataJSON),
                    dataType: "json",
                    success: showdata_update,
                    error: function () {
                        alert("error-admin_product_update_api.php");
                    }
                });
            }

            function showDataList(data) {
                // 宣告一個變數來存放所有資料
                var allData = data.data;

                // 左側列表
                $("#mylist").empty();

                var counter = {};
                allData.forEach(function (product) {
                    var productType = product.Ptype;
                    if (!counter[productType]) {
                        counter[productType] = 1;
                    } else {
                        counter[productType]++;
                    }
                });

                var totalSum = 0;
                for (var type in counter) {
                    totalSum += counter[type];
                }

                $("#mylist").append('<li class="list-group-item"><div class="d-flex" data-ptype="allType"><div>' +
                    '家具總覽' +
                    '</div><span class="badge rounded-pill text-bg-secondary ms-auto">' +
                    totalSum +
                    "</span></div></li>");

                for (var type in counter) {
                    var strHTML =
                        '<li class="list-group-item"><div class="d-flex" data-ptype="' + type + '"><div>' +
                        type +
                        '</div><span class="badge rounded-pill text-bg-secondary ms-auto">' +
                        counter[type] +
                        "</span></div></li>";
                    $("#mylist").append(strHTML);
                }

                var counter = {};
                allData.forEach(function (product) {
                    var productType = product.Ptype;

                    // 加入條件判斷 product.Shelf === 'Y'
                    if (product.Shelf === 'Y') {
                        if (!counter[productType]) {
                            counter[productType] = 1;
                        } else {
                            counter[productType]++;
                        }
                    }
                });

                var totalSum = 0;
                for (var type in counter) {
                    totalSum += counter[type];
                }

                $("#mylist").append('<li class="list-group-item"><div class="d-flex" data-ptype="allType"><div>' +
                    '已上架' +  // 更新顯示內容
                    '</div><span class="badge rounded-pill text-bg-secondary ms-auto">' +
                    totalSum +
                    "</span></div></li>");

                $("#mylist").on("click", ".list-group-item", function () {
                    var productType = $(this).find("div").data("ptype");
                    var filteredData = [];

                    // 獲取點擊的列表項目是否已上架
                    var onShelf = $(this).find("div").text().includes("已上架");

                    if (productType === "allType") {
                        // 如果是顯示所有產品，根據是否已上架過濾數據
                        if (onShelf) {
                            filteredData = allData.filter(function (product) {
                                return product.Shelf === 'Y';
                            });
                        } else {
                            filteredData = allData;
                        }
                    } else {
                        // 如果是顯示特定類型的產品，同樣根據是否已上架過濾數據
                        filteredData = allData.filter(function (product) {
                            return product.Ptype === productType && (onShelf ? product.Shelf === 'Y' : true);
                        });
                    }

                    console.log(productType);
                    console.log(filteredData);


                    $("#mydata").empty();
                    $("#pageList").addClass("d-none");
                    filteredData.forEach(function (item) {
                        var strHTML = '<tr><td>' + item.ID + '</td><td>' + item.Pname + '</td><td><img src="/202312/upload/' + item.Pimage + '" height="100px"></td><td> <span class="badge text-bg-danger">' + item.Ptype + '</span></td><td>' + item.Pintro + '</td><td>' + item.Num + '</td><td>' + item.Price + '</td><td>' + item.Shelf + '</td><td class="text-center "><div class="row"><div class="col-12"><button class="btn btn-success m-1" data-id="' + item.ID + '" data-pname="' + item.Pname + '" data-pimage="' + item.Pimage + '" " data-ptype="' + item.Ptype + '" " data-pintro="' + item.Pintro + '" " data-psize="' + item.Psize + '" " data-num="' + item.Num + '" " data-price="' + item.Price + '" " data-shelf="' + item.Shelf + '"   id="update_btn"  data-bs-toggle="modal" data-bs-target="#update_modal">更新</button></div><div class="col-12"><button class="btn btn-danger  m-1" id="delete_btn" data-id="' + item.ID + '">刪除</button></div></div></td></tr>';
                        $("#mydata").append(strHTML);
                    });
                });
            }

            function showdata(data) {
                data.data.forEach(function (item, key) {
                    if (key % 10 == 0) {
                        newData.push([]);
                    }
                    var page = parseInt(key / 10);
                    newData[page].push(item);
                });
                drawTable(0);


                $("#pageList").empty();
                newData.forEach(function (item, key) {
                    var thisPage = key + 1;
                    var strHTML = ' <li class="page-item"><a class="page-link" href="#" onclick="drawTable(' + key + ')">' + thisPage + '</a></li>';
                    $("#pageList").append(strHTML);
                });
                // console.log(newData);
            }

            function drawTable(page) {
                $("#mydata").empty();
                newData[page].forEach(function (item) {
                    var strHTML = '<tr><td>' + item.ID + '</td><td>' + item.Pname + '</td><td><img src="/202312/upload/' + item.Pimage + '" height="100px"></td><td> <span class="badge text-bg-danger">' + item.Ptype + '</span></td><td>' + item.Pintro + '</td><td>' + item.Num + '</td><td>' + item.Price + '</td><td>' + item.Shelf + '</td><td class="text-center "><div class="row"><div class="col-12"><button class="btn btn-success m-1" data-id="' + item.ID + '" data-pname="' + item.Pname + '" data-pimage="' + item.Pimage + '" " data-ptype="' + item.Ptype + '" " data-pintro="' + item.Pintro + '" " data-psize="' + item.Psize + '" " data-num="' + item.Num + '" " data-price="' + item.Price + '" " data-shelf="' + item.Shelf + '"   id="update_btn"  data-bs-toggle="modal" data-bs-target="#update_modal">更新</button></div><div class="col-12"><button class="btn btn-danger  m-1" id="delete_btn" data-id="' + item.ID + '">刪除</button></div></div></td></tr>';
                    $("#mydata").append(strHTML);
                });
            }

            function showdata_update(data) {
                if (data.state) {
                    Swal.fire({
                        title: (data.message),
                        showDenyButton: true,
                        confirmButtonText: "確認",
                    }).then((result) => {
                        if (result.isConfirmed) {
                            Swal.fire("更新成功!", "", "success");
                            location.reload();
                        } else if (result.isDenied) {
                            Swal.fire("更新失敗", "", "error");
                        }
                    });
                } else {
                    alert(data.message);
                }
            }

            function showdata_delete(data) {
                if (data.state) {
                    Swal.fire({
                        title: data.message,
                        showDenyButton: true,
                        showCancelButton: true,
                        confirmButtonText: "確認",
                        denyButtonText: `Don't save`
                    }).then((result) => {
                        if (result.isConfirmed) {
                            location.reload();
                        }
                    });
                }
            }




        </script>
    </section>
</body>

</html>