<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>會員管理</title>
</head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/all.min.css">
<link rel="stylesheet" href="css/myall.css">
<link rel="stylesheet" href="css/spa.css">
<link href="/img/favicon.ico" rel="shortcut icon" />
<style>
    .banner {
        height: 280px;
        background-image: url(img/sofa10.jpg);
        background-position: center 60%;
        background-size: cover;
    }
</style>

<body>
    <!-- section01 navbar-->
    <div class="fixed-top">

        <!-- section02 navbar-->

        <section>
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark ">
                <div class="container">
                    <div class="wow animate__backInDown " data-wow-duration="1s" data-wow-delay="0s"
                        data-wow-iteration="1">
                        <a class="navbar-brand" href="#">
                            <i class="fa-solid fa-couch"></i>
                        </a>
                    </div>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active pe-3 fw-800 " aria-current="page"
                                    href="admin/ideal_admin_index.html"> IDEAL Furnishings 管理系統</a>
                            </li>
                            <li class="nav-item px-4 d-none" id="nav_01">
                                <a class="nav-link " aria-current="page"
                                    href="admin/ideal_admin_product_create.html">商品建檔</a>
                            </li>
                            <li class="nav-item px-4 d-none" id="nav_02">
                                <a class="nav-link " aria-current="page"
                                    href="admin/ideal_admin_product.html">商品管理</a>
                            </li>
                            <li class="nav-item px-4 d-none" id="nav_03">
                                <a class="nav-link " aria-current="page" href="admin/ideal_admin_order.html">訂單管理</a>
                            </li>
                            <li class="nav-item px-4 d-none" id="nav_04">
                                <a class="nav-link active" aria-current="page"
                                    href="admin/ideal_admin_member_control.html">會員管理</a>
                            </li>

                        </ul>

                        <div>


                            <li class="nav-item dropdown list-unstyled text-light d-none" id="member_list">
                                <a class="nav-link dropdown-toggle ps-3" href="#" role="button"
                                    data-bs-toggle="dropdown" aria-expanded="false" id="user_message">
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <li><a class="dropdown-item " href="#" target="_blank">管理員資訊</a></li>
                                    <li><a class="dropdown-item " href="#" id="logout_btn">管理員登出</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item disabled" href="#">Something else here</a></li>
                                </ul>
                            </li>

                            <button class="btn btn-outline-warning me-2 " data-bs-toggle="modal"
                                data-bs-target="#loginModal" id="nav_log_btn">登入</button>
                            <button class="btn btn-warning me-2 " data-bs-toggle="modal" data-bs-target="#registerModal"
                                id="nav_reg_btn">註冊</button>


                        </div>
                    </div>
                </div>
            </nav>

        </section>
    </div>

    <!-- section02 loginModal -->
    <div class="modal fade" id="loginModalAdmin" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header text-bg-dark">
                    <h5 class="modal-title" id="exampleModalLabel">管理員登入</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <label for="login_username" class="form-label">帳號</label>
                    <input type="text" class="form-control" id="loginAdmin_username" name="loginAdmin_username">
                    <label for="login_password" class="form-label">密碼</label>
                    <input type="password" class="form-control" id="loginAdmin_password" name="loginAdmin_password">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-warning" id="loginAdmin_btn">登入</button>
                </div>
            </div>
        </div>
    </div>



    <!-- 登入註冊 -->
    <!-- section02 loginModal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header text-bg-dark">
                    <h5 class="modal-title" id="exampleModalLabel">管理員登入</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <label for="login_username" class="form-label">帳號</label>
                    <input type="text" class="form-control" id="login_username" name="login_username">
                    <label for="login_password" class="form-label">密碼</label>
                    <input type="password" class="form-control" id="login_password" name="login_password">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-warning" id="login_btn">登入</button>
                </div>
            </div>
        </div>
    </div>

    <!-- section02 registerModal -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header text-bg-dark">
                    <h5 class="modal-title" id="exampleModalLabel">管理員註冊</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row">

                        <div class="col-12">
                            <div>
                                <!-- for取username，點標籤時會帶到輸入框 -->
                                <label for="username" class="form-label">帳號</label>
                                <input type="text" class="form-control " placeholder="請輸入6至12字半形英文或數字" id="username"
                                    name="username">
                                <div class="valid-feedback">帳號可以使用</div>
                                <div class="invalid-feedback">帳號不可以使用</div>
                            </div>

                            <div>
                                <label for="email" class="form-label">電子郵件</label>
                                <input type="text" class="form-control" placeholder="請輸入電子郵件信箱" id="email" name="email">
                                <div class="valid-feedback">格式符合規定</div>
                                <div class="invalid-feedback">格式不符合規定</div>
                            </div>

                            <div>
                                <label for="password" class="form-label">密碼</label>
                                <input type="password" class="form-control" placeholder="請輸入6至12字半形英文或數字" id="password"
                                    name="password">
                                <div class="valid-feedback">字數符合規定</div>
                                <div class="invalid-feedback">字數不符合規定</div>
                            </div>

                            <div>
                                <label for="" class="form-label">確認密碼</label>
                                <input type="password" class="form-control" placeholder="請確認密碼" id="re_password"
                                    name="re_password">
                                <div class="valid-feedback">輸入內容相符</div>
                                <div class="invalid-feedback">輸入內容不相符</div>
                            </div>

                            <div class="form-check pt-3">
                                <input class="form-check-input" type="checkbox" id="chk01" name="chk01">
                                <label class="form-check-label" for="chk01">
                                    確認註冊
                                </label>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-warning" id="reg_btn">註冊</button>
                </div>
            </div>
        </div>
    </div>

    <!-- section03 banner -->
    <div class="banner bg-cover"></div>
    <div class="container">
        <div class="row">
            <div class="col-2">
                <h5 class=" mt-3">會員管理</h5>
            </div>
            <div class="col-2">
                <a href="admin/ideal_admin_member_chart.html" class="btn btn-warning mt-3">圖表資料</a>
            </div>
        </div>
     
        <table class="table table-bordered table-striped table-hover table-sm table-rwd mt-4">
            <thead class="table-dark text-center">
                <tr>
                    <th class="text-center col-1">會員編號</th>
                    <th class="text-center col-1">會員帳號</th>
                    <th class="text-center col-3">電子郵件</th>
                    <th class="text-center ">居住地</th>
                    <th class="text-center col-1">狀態</th>
                    <th class="text-center">註冊日期</th>
                    <th class="text-center">修改</th>
                    <th class="text-center">刪除</th>

                </tr>
            </thead>
            <tbody id="mydata">
                <tr>
                    <td>xxx</td>
                    <td>12345678</td>
                    <td>100</td>
                    <td>香醇可口</td>
                    <td>香醇可口</td>
                    <td class="text-center"><button class="btn btn-success" data-bs-toggle="modal"
                            data-bs-target="#update_btn" id="update_btn" name="update_modal">修改</button></td>
                    <td class="text-center"><button class="btn btn-danger" id="delete_btn" name="delete_btn">刪除</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>



    <!-- update Modal -->
    <div class="modal fade" id="update_modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-dark">
                    <h1 class="modal-title fs-5 text-bg-dark" id="exampleModalLabel">會員修改</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="update_modal_username" class="form-check-label">帳號</label>
                        <input type="text" class="form-control" id="update_modal_username" name="update_modal_username"
                            disabled>
                    </div>
                    <div class="mb-3">
                        <label for="update_modal_email" class="form-check-label">電子郵件</label>
                        <input type="text" class="form-control" id="update_modal_email" name="update_modal_email">
                    </div>
                    <div class="mb-3">
                        <label for="update_modal_state" class="form-label">會員狀態</label>
                        <div class="form-check form-switch">
                            <input type="checkbox" id="update_modal_state" class="form-check-input">
                            <label for="update_modal_state" class="form-check-label">正常</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="modal_update_btn">保存修改</button>
                </div>
            </div>

        </div>
    </div>


    <div class="container">
        <nav aria-label="...">
            <ul class="pagination justify-content-center" id="pageList">
                <li class="page-item disabled">
                    <span class="page-link">Previous</span>
                </li>
                <li class="page-item"><a class="page-link" href="#" onclick="drawTable(0)" id="page">1</a></li>
                <li class="page-item">
                    <a class="page-link" href="#">Next</a>
                </li>
            </ul>
        </nav>
    </div>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.4/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/counterup2@2.0.2/dist/index.js">	</script>
    <script src="/js/cookie.js"></script>
    <script src="/js/admin_login.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>




    <script>
        var u_id; //for update
        var newData = [];
        $(function () {
            // 監聽switch外送
            $("#update_modal_state").click(function () {
                // this現在的動作
                console.log($(this).is(':checked'));
                if ($(this).is(':checked')) {
                    $(this).next().text('正常');
                    switch01 = '正常';
                } else {
                    $(this).next().text('停權');
                    switch01 = '停權';
                }
            });


            // Read member data
            $.ajax({
                type: "GET",
                url: "member_read_api.php",
                async: false,
                dataType: "json",
                success: showdata,
                error: function () {
                    alert("error-member_read_api.php");
                }
            });

            // #update_btn modify button
            $("body").on("click", "#mydata #update_btn", function () {
                console.log($(this).data("id") + $(this).data("email") + $(this).data("username") + $(this).data("state"));
                u_id = $(this).data("id");
                $("#update_modal_username").val($(this).data("username"));
                $("#update_modal_email").val($(this).data("email"));
                // $("#update_modal_state").val($(this).data("state"));
                $("input[id=update_modal_state]").prop("checked", $(this).data("state"));
            });

            // #delete_modal_btn listen to delete button
            $("body").on("click", "#mydata #delete_btn", function () {
                if (confirm("確認刪除？")) {
                    console.log($(this).data("id"));
                    var dataJSON = {};
                    dataJSON["ID"] = $(this).data("id");
                    console.log(JSON.stringify(dataJSON));

                    $.ajax({
                        type: "POST",
                        url: "member_delete_api.php",
                        data: JSON.stringify(dataJSON),
                        dataType: "json",
                        success: showdata_delete,
                        error: function () {
                            alert("error-member_delete_api.php");
                        }
                    });
                }
            });

            // #update_modal_btn listen to modify button(confirm)
            $("#modal_update_btn").click(function () {
                var dataJSON = {};
                dataJSON["ID"] = u_id;
                dataJSON["Email"] = $("#update_modal_email").val();
                dataJSON["State"] = $("#update_modal_state").prop("checked") ? "正常" : "n";
                console.log(JSON.stringify(dataJSON));

                $.ajax({
                    type: "POST",
                    url: "member_update_api.php",
                    data: JSON.stringify(dataJSON),
                    dataType: "json",
                    success: showdata_update,
                    error: function () {
                        alert("error-member_update_api.php");
                    }
                });
            });
        });

        function showdata(data) {
            data.data.forEach(function (item, key) {
                if (key % 10 == 0) {
                    newData.push([]);
                }
                var page = parseInt(key / 10);
                newData[page].push(item);
            });
            drawTable(0);

            $("#pageList").empty();
            newData.forEach(function (item, key) {
                var thisPage = key + 1;
                var strHTML = ' <li class="page-item"><a class="page-link" href="#" onclick="drawTable(' + key + ')">' + thisPage + '</a></li>';
                $("#pageList").append(strHTML);
            });

            console.log(newData);
        }

        function drawTable(page) {
            $("#mydata").empty();
            newData[page].forEach(function (item) {
                var strHTML = '<tr><td>' + item.ID + '</td><td>' + item.Username + '</td><td>' + item.Email + '</td><td>' + item.City + '' + item.Town + '</td><td>' + item.State + '</td><td>' + item.Created_at + '</td><td class="text-center"><button class="btn btn-success me-2" data-id="' + item.ID + '" data-email="' + item.Email + '" data-username="' + item.Username + '"" data-state="' + item.State + '" id="update_btn"  data-bs-toggle="modal" data-bs-target="#update_modal">更新</button></td><td class="text-center"><button class="btn btn-danger" id="delete_btn" data-id="' + item.ID + '">刪除</button></td></tr>';
                $("#mydata").append(strHTML);
            });
        }

        function showdata_update(data) {
            if (data.state) {
                Swal.fire({
                    title: (data.message),
                    showDenyButton: true,
                    showCancelButton: false,
                    confirmButtonText: "確認",
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire("Saved!", "", "success");
                        location.href = "ideal_admin_member_control.html";
                    } else if (result.isDenied) {
                        Swal.fire("更新失敗", "", "error");
                    }
                });
            } else {
                alert(data.message);
            }
        }

        function showdata_delete(data) {
            if (data.state) {
                Swal.fire({
                    title: data.message,
                    showDenyButton: true,
                    showCancelButton: false,
                    confirmButtonText: "確認",
                    denyButtonText: `Don't save`
                }).then((result) => {
                    if (result.isConfirmed) {
                        location.href = "ideal_admin_member_control.html";
                    }
                });
            }
        }




    </script>
</body>

</html>